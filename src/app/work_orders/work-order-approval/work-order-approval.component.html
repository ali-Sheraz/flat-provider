<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-wrapper">
  <div class="content container-fluid">
    <div class="chat-main-row">
      <div class="chat-main-wrapper">
        <div class="col-xs-8 message-view task-view">
          <div class="chat-window">
            <div class="chat-header">
              <div class="navbar">
                <div class="pull-left ticket-view-details">
                  <div class="ticket-header">
                    <span>Status: </span> <span class="label label-warning">{{viewT.status}}</span> <span
                      class="m-l-15 text-muted">House Number: </span>
                    <a href="javascript:" >{{viewT.house_number}}</a>
                    <span class="m-l-15 text-muted">Created Date: </span>
                    <span>{{viewT.created_date}}</span>
                    <!-- <span class="m-l-15 text-muted">Created by:</span>
                  <span><a href="profile.html">{{viewT.assign_staff}}</a></span> -->
                  </div>
                </div>
                <a class="task-chat profile-rightbar pull-right" href="#task_window"><i
                    class="fa fa fa-comment"></i></a>
              </div>
            </div>
            <div class="chat-contents">
              <div class="chat-content-wrap">
                <div class="chat-wrap-inner">
                  <div class="chat-box">
                    <div class="task-wrapper">
                      <div class="panel">
                        <div class="panel-body">
                          <div class="project-title">
                            <div class="m-b-20">
                              <span class="h5 panel-title ">{{viewT.id}}</span>
                              <div class="pull-right ticket-priority"><span>Priority : </span>
                                <div class="btn-group">
                                  <a href="javascript:" class="label label-danger dropdown-toggle"
                                    data-toggle="dropdown">{{viewT.priority}} <span class="caret"></span></a>
                                  <ul class="dropdown-menu dropdown-menu-right">
                                    <li><a href="javascript:"><i class="fa fa-dot-circle-o text-danger"></i> Highest
                                      </a></li>
                                    <li><a href="javascript:"><i class="fa fa-dot-circle-o text-info"></i> High </a>
                                    </li>
                                    <li><a href="javascript:"><i class="fa fa-dot-circle-o text-primary"></i> Medium
                                      </a></li>
                                    <li><a href="javascript:"><i class="fa fa-dot-circle-o text-success"></i> Low </a>
                                    </li>
                                  </ul>
                                </div>
                              </div>
                            </div>
                          </div>
                          <p>{{viewT.description}}</p>
                        </div>
                      </div>

                      <div class="col-lg-6">
                        <div class="panel">
                          <div class="panel-body">
                            <h6 class="panel-title m-b-15">Work Order details</h6>
                            <table class="table table-striped table-border">
                              <tbody>
                                <tr>
                                  <td>Created By:</td>
                                  <td class="text-right">{{viewT.created_by}}</td>
                                </tr>
                                <tr>
                                  <td>Creation Date:</td>
                                  <td class="text-right">{{viewT.created_date}}</td>
                                </tr>
                                <tr>
                                  <td>Work Order Subject:</td>
                                  <td class="text-right">{{viewT.subject}}</td>
                                </tr>
                                <tr>
                                  <tr>
                                    <td>House Number:</td>
                                    <td class="text-right">{{viewT.house_number}}</td>
                                  </tr>
                                  <tr>
                                    <td>Street:</td>
                                    <td class="text-right">{{viewT.street}}</td>
                                  </tr>
                                  <tr>
                                  <td>Days to Execute:</td>
                                  <td class="text-right">{{viewT.days_to_execute}}</td>
                                </tr>
                                <tr>
                                  <td>Floor:</td>
                                  <td class="text-right">{{viewT.floor}}</td>
                                </tr>
                                <tr>
                                  <td>Location:</td>
                                  <td class="text-right">{{viewT.location}}</td>
                                </tr>
                                <tr>
                                  <td>Element:</td>
                                  <td class="text-right">{{viewT.element}}</td>
                                </tr>
                                <tr>
                                  <td>Defect:</td>
                                  <td class="text-right">{{viewT.defect}}</td>
                                </tr>
                                <tr>
                                  <td>Cause:</td>
                                  <td class="text-right">{{viewT.cause}}</td>
                                </tr>
                                <tr>
                                  <td>Next Action:</td>
                                  <td class="text-right">{{viewT.next_action}}</td>
                                </tr>
                                <tr>
                                  <td>Main Contractor:</td>
                                  <td class="text-right">{{viewT.main_contractor}}</td>
                                </tr>
                                <tr>
                                  <td>Date Scheduled:</td>
                                  <td class="text-right">{{viewT.date_scheduled}}</td>
                                </tr>
                                <tr>
                                  <td>Time Scheduled:</td>
                                  <td class="text-right">{{viewT.time_scheduled}}{{viewT.ampm}}</td>
                                </tr>
                                <tr>
                                  <td>Days Open:</td>
                                  <td class="text-right">{{viewT.days_open}}</td>
                                </tr>
                                <tr>
                                  <td>Costs:</td>
                                  <td class="text-right">{{viewT.costs}}</td>
                                </tr>
                                <tr>
                                  <td>Invoice:</td>
                                  <td class="text-right">{{viewT.invoice}}</td>
                                </tr>
                                <tr>
                                  <td>Charge to:</td>
                                  <td class="text-right">{{viewT.charge_to}}</td>
                                </tr>
                                <tr>
                                  <td>Date Closed:</td>
                                  <td class="text-right">{{viewT.date_closed}}</td>
                                </tr>
                                <tr>
                                  <td>Time Closed:</td>
                                  <td class="text-right">{{viewT.time_closed}}</td>
                                </tr>
                                <tr>
                                  <td>Closed By:</td>
                                  <td class="text-right">{{viewT.closed_by}}</td>
                                </tr>
                              </tbody>
                            </table>
                            <p class="m-b-5">Progress <span class="text-success pull-right">40%</span></p>
                            <div class="progress progress-xs m-b-0">
                              <div class="progress-bar progress-bar-success" role="progressbar" tooltip="40%"
                                title="40%" style="width: 40%"></div>
                            </div>
                          </div>
                        </div>
                      </div>





                      <div class="panel">
                        <div class="panel-body">
                          <h5 class="panel-title m-b-20">Uploaded image files</h5>
                          <div class="row">
                            <div class="col-md-3 col-sm-6">
                              <div class="thumbnail">
                                <div class="thumb">
                                  <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                                </div>
                                <div class="caption text-center">
                                  demo.png
                                </div>
                              </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                              <div class="thumbnail">
                                <div class="thumb">
                                  <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                                </div>
                                <div class="caption text-center">
                                  demo.png
                                </div>
                              </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                              <div class="thumbnail">
                                <div class="thumb">
                                  <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                                </div>

                                <div class="caption text-center">
                                  demo.png
                                </div>
                              </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                              <div class="thumbnail">
                                <div class="thumb">
                                  <img src="assets/img/placeholder.png" class="img-responsive" alt="">
                                </div>
                                <div class="caption text-center">
                                  demo.png
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>





                      <div class="panel">
                        <div class="panel-body">
                          <h5 class="panel-title m-b-20">Uploaded files</h5>
                          <ul class="files-list">
                            <li>
                              <div class="files-cont">
                                <div class="file-type">
                                  <span class="files-icon"><i class="fa fa-file-pdf-o"></i></span>
                                </div>
                                <div class="files-info">
                                  <span class="file-name text-ellipsis"><a
                                      href="javascript:">Ticket_document.xls</a></span>
                                  <span class="file-author"><a href="javascript:">John Doe</a></span> <span
                                    class="file-date">May 5th at 8:21 PM</span>
                                  <div class="file-size">Size: 14.8Mb</div>
                                </div>
                                <ul class="files-action">
                                  <li class="dropdown">
                                    <a href="javascript:" class="dropdown-toggle btn btn-default btn-xs"
                                      data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>
                                    <ul class="dropdown-menu">
                                      <li><a href="javascript:void(0)">Download</a></li>
                                      <li><a href="javascript:" data-toggle="modal" data-target="#share_files">Share</a>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </div>
                            </li>
                            <li>
                              <div class="files-cont">
                                <div class="file-type">
                                  <span class="files-icon"><i class="fa fa-file-pdf-o"></i></span>
                                </div>
                                <div class="files-info">
                                  <span class="file-name text-ellipsis"><a
                                      href="javascript:">Issue_report.xls</a></span>
                                  <span class="file-author"><a href="javascript:">John Doe</a></span> <span
                                    class="file-date">May 5th at 5:41 PM</span>
                                  <div class="file-size">Size: 14.8Mb</div>
                                </div>
                                <ul class="files-action">
                                  <li class="dropdown">
                                    <a href="javascript:" class="dropdown-toggle btn btn-default btn-xs"
                                      data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-h"></i></a>
                                    <ul class="dropdown-menu">
                                      <li><a href="javascript:void(0)">Download</a></li>
                                      <li><a href="javascript:" data-toggle="modal" data-target="#share_files">Share</a>
                                      </li>
                                    </ul>
                                  </li>
                                </ul>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </div>


                      <div class="panel">
                        <div class="panel-body">
                          <h5 class="panel-title m-b-20">Remarks & Approval Log</h5>
                        
                          <div class="row">
                            <div class="col-md-12">
                              <div class="table-responsive table-responsive-inherit">
                                <table class="table table-striped custom-table" [mfData]="rows" #mf="mfDataTable" [mfRowsOnPage]="1000">
                                  <thead>
                                    <tr>
                                      <th style="width: 10%">
                                        <mfDefaultSorter by="id">Created Date</mfDefaultSorter>
                                      </th>
                                      <th style="width: 10%">
                                        <mfDefaultSorter by="id">Created Time</mfDefaultSorter>
                                      </th>
                                      <th style="width: 10%">
                                        <mfDefaultSorter by="subject">Created By</mfDefaultSorter>
                                      </th>
                                      <th style="width: 15%">
                                        <mfDefaultSorter by="location">Action</mfDefaultSorter>
                                      </th>
                                      <th style="width: 40%">
                                        <mfDefaultSorter by="element">Remarks</mfDefaultSorter>
                                      </th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let approvalLog of approvalLog">
                                      <td>{{approvalLog.created_date}}</td>
                                      <td>{{approvalLog.created_time}}</td>
                                      <td>{{approvalLog.created_by}}</td>
                                      <td>{{approvalLog.action}}</td>
                                      <td>{{approvalLog.remarks}}</td>
                                    </tr>
                                  </tbody>
                                  <tfoot>
                                    <tr>
                                      <td colspan="12">
                                        <mfBootstrapPaginator></mfBootstrapPaginator>
                                      </td>
                                    </tr>
                                  </tfoot>
                                </table>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>


                      <div class="panel">
                        <div class="panel-body">
                          <h5 class="panel-title m-b-20">Next Action</h5>
                          <div class="row filter-row">

                            <div class="col-sm-6 col-md-2 col-xs-6">
                              <div class="form-group form-focus select-focus">
                                <label class="control-label">Action<span class="text-danger m-l-5">*</span></label>
                                <select class="select floating form-control" [(ngModel)]="viewT.next_action"
                                  name="next_action" #next_action="ngModel" required>
                                  <option *ngFor="let currentActions of currentActions">
                                    {{currentActions}}
                                  </option>
                                </select>
                              </div>
                            </div>

                            <div class="col-md-12">
                              <div class="form-group">
                                <label>Remarks</label>
                                <textarea class="form-control" [(ngModel)]="viewT.approver_remarks" name="approver_remarks"
                                  #approver_remarks="ngModel" required></textarea>
                              </div>
                            </div>

                            <div class="row" *ngIf="nextActionSuccess">
                              <div class="col-xs-12">
                                <p class="alert alert-success">
                                  <strong>Next Action!</strong> {{nextActionMsg}}
                                </p>
                              </div>
                            </div>

                            <div class="col-sm-6 col-md-2 col-xs-6" style="width:100%;">
                              <a style="width: 30%; margin: 0px auto;" href="javascript:"
                                class="btn btn-success btn-block" (click)='updateTicket(viewT)'> Next Action </a>
                            </div>
                          </div>
                        </div>

                      </div>



                    </div>
                    <div class="notification-popup hide">
                      <p>
                        <span class="task"></span>
                        <span class="notification-text"></span>
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- <div class="col-xs-4 message-view task-chat-view" id="task_window">
        <div class="chat-window">
          <div class="chat-header">
            <div class="navbar">
              <div class="task-assign">
                <span class="assign-title">Assigned to </span> 
                <a href="javascript:" data-toggle="tooltip" data-placement="bottom" title="John Doe">
                  <img src="assets/img/user.jpg" class="avatar" alt="" height="20" width="20">
                </a>
                <a href="javascript:" class="followers-add" title="Add Assignee" data-toggle="modal" data-target="#assignee"><i class="material-icons">add</i></a>
              </div>
              <ul class="nav navbar-nav pull-right chat-menu">
                <li class="dropdown">
                  <a href="javascript:" class="dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a>
                  <ul class="dropdown-menu">
                    <li><a href="javascript:" title="Edit" data-toggle="modal" data-target="#edit_ticket">Edit Ticket</a></li>
                   <li *ngIf='userLevel === "PD Admin" || userLevel === "PLA Admin"'><a href="javascript:" title="Delete" data-toggle="modal" data-target="#delete_ticket">Delete Ticket</a></li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
          <div class="chat-contents task-chat-contents">
            <div class="chat-content-wrap">
              <div class="chat-wrap-inner">
                <div class="chat-box">
                  <div class="chats">
                    <div class="chat chat-left">
                      <div class="chat-avatar">
                        <a href="javascript:" class="avatar">
                          <img alt="John Doe" src="assets/img/user.jpg" class="img-responsive img-circle">
                        </a>
                      </div>
                      <div class="chat-body">
                        <div class="chat-bubble">
                          <div class="chat-content">
                            <span class="task-chat-user">John Doe</span> <span class="chat-time">8:35 am</span>
                            <p>I'm just looking around.</p>
                            <p>Will you tell me something about yourself? </p>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="completed-task-msg"><span class="task-success"><a href="javascript:">John Doe</a> closed this ticket.</span> <span class="task-time">Today at 9:27am</span></div>
                    <div class="chat chat-left">
                      <div class="chat-avatar">
                        <a href="javascript:" class="avatar">
                          <img alt="John Doe" src="assets/img/user.jpg" class="img-responsive img-circle">
                        </a>
                      </div>
                      <div class="chat-body">
                        <div class="chat-bubble">
                          <div class="chat-content">
                            <span class="task-chat-user">John Doe</span> <span class="file-attached">attached 3 files <i class="fa fa-paperclip" aria-hidden="true"></i></span> <span class="chat-time">Dec 17, 2014 at 4:32am</span>
                            <ul class="attach-list">
                              <li><i class="fa fa-file"></i> <a href="javascript:">project_document.avi</a></li>
                              <li><i class="fa fa-file"></i> <a href="javascript:">video_conferencing.psd</a></li>
                              <li><i class="fa fa-file"></i> <a href="javascript:">landing_page.psd</a></li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="chat chat-left">
                      <div class="chat-avatar">
                        <a href="javascript:" class="avatar">
                          <img alt="Jeffery Lalor" src="assets/img/user.jpg" class="img-responsive img-circle">
                        </a>
                      </div>
                      <div class="chat-body">
                        <div class="chat-bubble">
                          <div class="chat-content">
                            <span class="task-chat-user">Jeffery Lalor</span> <span class="file-attached">attached file <i class="fa fa-paperclip" aria-hidden="true"></i></span> <span class="chat-time">Yesterday at 9:16pm</span>
                            <ul class="attach-list">
                              <li class="pdf-file"><i class="fa fa-file-pdf-o"></i> <a href="javascript:">Document_2016.pdf</a></li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="chat chat-left">
                      <div class="chat-avatar">
                        <a href="javascript:" class="avatar">
                          <img alt="Jeffery Lalor" src="assets/img/user.jpg" class="img-responsive img-circle">
                        </a>
                      </div>
                      <div class="chat-body">
                        <div class="chat-bubble">
                          <div class="chat-content">
                            <span class="task-chat-user">Jeffery Lalor</span> <span class="file-attached">attached file <i class="fa fa-paperclip" aria-hidden="true"></i></span> <span class="chat-time">Today at 12:42pm</span>
                            <ul class="attach-list">
                              <li class="img-file">
                                <div class="attach-img-download"><a href="javascript:">logo2.png</a></div>
                                <div class="task-attach-img"><img src="assets/img/logo2.png" alt=""></div>
                              </li>
                              <li class="img-file">
                                <div class="attach-img-download"><a href="javascript:">avatar-1.jpg</a></div>
                                <div class="task-attach-img"><img src="assets/img/user.jpg" alt=""></div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="task-information"><span class="task-info-line"><a class="task-user" href="javascript:">John Doe</a> <span class="task-info-subject">marked ticket as reopened</span></span><div class="task-time">1:16pm</div></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="chat-footer">
            <div class="message-bar">
              <div class="message-inner">
                <a class="link attach-icon" href="javascript:" data-toggle="modal" data-target="#drag_files"><img src="assets/img/attachment.png" alt=""></a>
                <div class="message-area"><div class="input-group">
                  <textarea class="form-control" placeholder="Type message..."></textarea>
                  <span class="input-group-btn">
                    <button class="btn btn-primary" type="button"><i class="fa fa-send"></i></button>
                  </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="project-members task-followers">
              <span class="followers-title">Followers</span>
              <a href="javascript:" data-toggle="tooltip" title="Richard Miles">
                <img src="assets/img/user.jpg" class="avatar" alt="Richard Miles" height="20" width="20">
              </a>
              <a href="javascript:" data-toggle="tooltip" title="John Smith">
                <img src="assets/img/user.jpg" class="avatar" alt="John Smith" height="20" width="20">
              </a>
              <a href="javascript:" data-toggle="tooltip" title="Mike Litorus">
                <img src="assets/img/user.jpg" class="avatar" alt="Mike Litorus" height="20" width="20">
              </a>
              <a href="javascript:" data-toggle="tooltip" title="Wilmer Deluna">
                <img src="assets/img/user.jpg" class="avatar" alt="Wilmer Deluna" height="20" width="20">
              </a>
              <a href="javascript:" class="followers-add" data-toggle="modal" data-target="#task_followers"><i class="material-icons">add</i></a>
            </div>
          </div>
        </div>
      </div>  -->



    </div>

    <div id="delete_ticket" class="modal custom-modal fade" role="dialog" data-backdrop="static">
      <div class="modal-dialog">
        <div class="modal-content modal-md">
          <div class="modal-header">
            <h4 class="modal-title">Delete Ticket</h4>
          </div>
          <form>
            <div class="modal-body card-box">
              <p>Are you sure you want to DELETE this? ticket?</p>
              <div class="m-t-20"> <a href="javascript:" class="btn btn-default" data-dismiss="modal">Close</a>
                <button type="submit" class="btn btn-danger">Delete</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
